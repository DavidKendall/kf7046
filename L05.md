---
layout: default
title: Primary DNS server
license: not needed
---

## Introduction

Your aim in this lab is to:

* Install a bind9 server on your server VM.
* Configure bind9 as a primary DNS server with caching
* Identify and understand the network activity generated by a DNS lookup
to your server.

## Instructions

1.   Configure the server to support a DNS zone of `student.co.uk` (follow the
     lecture notes) and configure some IP mappings. Configure the addresses as
     below. Where possible, use `CNAME` records. The mail server should be
     configured as an `MX` record:

     ```
     a. 192.168.100.2                                www.student.co.uk
     b. 192.168.100.21                               rtlab1.student.co.uk
     c. <your client ip address>                     me.student.co.uk
     d. 192.168.100.1                                master.student.co.uk
     e. 192.168.100.2                                mail.student.co.uk
     f. 192.168.100.254                              gateway.student.co.uk
     ```
1.   Check the configuration file and the zone file before proceeding beyond
     this point. The command `named-checkconf` will check your configuration
     file for syntactic correctness. The command `named-checkzone` will check
     your zone file for syntactic correctness. **WARNING:** if a configuration
     file or a zone file is syntactically invalid, it will not be loaded when
     the bind9 service is started, and it may be the case that no error message
     is displayed. Example usage:

     ```sh
     $ named-checkconf /etc/bind/named.conf.local
     $ named-checkzone student.co.uk /etc/bind/db.student.co.uk
     ```
1.   Typically, the mail server name is stable and the zone file should allow
     long-term caching of its address.  The mapping of the `me` machine is
     dynamic; its address can change frequently and should not be cached.  All
     other machines should use a default TTL.
1.   Using a desktop VM, ensure its nameserver is set to `192.168.100.1` and
     carry out a dig search for:

     ```
     a. www.google.com
     b. www.student.co.uk
     c. me.student.co.uk
     d. The mail server
     ```
Do all searches succeed? If not, why not?
1.   Now change the nameserver of the desktop VM to the IP Address of your DNS
     server and carry out the following lookups:

     ```
     a. www.google.com
     b. www.student.co.uk
     ```
Do they return the correct IP address?
1.   Now add forwarders to your DNS server, as described in the last session,
     so the DNS server supports the zone `student.co.uk` and forwards all
     unknown requests.
     * Repeat the previous searches.
1.   Point a browser at

     ```
     a. www.student.co.uk
     b. rlab1.student.co.uk
     c. me.student.co.uk
     d. www.google.com
     ```
Observe what happens. Explain your observations.
1.   Use Wireshark to observe DNS traffic as you generate name searches.

* There is some [helpful
documentation](https://help.ubuntu.com/16.04/serverguide/dns.html) on
configuring a DNS server.

* More information about the `dig` command can be found using the [dig man
page](https://linux.die.net/man/1/dig)
